spring:
  datasource:
    url: ${SPRING_DATASOURCE_URL}
    username: ${SPRING_DATASOURCE_USERNAME}
    password: ${SPRING_DATASOURCE_PASSWORD}
  jpa:
    properties:
      hibernate.jdbc.time_zone: ${SPRING_JPA_PROPERTIES_HIBERNATE_JDBC_TIME_ZONE}
    hibernate:
      # ddl-auto est défini dans les profils (dev/prod)
  servlet:
    multipart:
      enabled: true
      max-file-size: 10MB
      max-request-size: 10MB
      file-size-threshold: 2KB

server:
  port: ${SERVER_PORT}
  max-http-header-size: 8KB
  max-http-post-size: 1MB
  max-http-form-post-size: 1MB

app:
  security:
    cors-allowed-origins:
      - ${APP_SECURITY_CORS_ALLOWED_ORIGINS_0}
      - ${APP_SECURITY_CORS_ALLOWED_ORIGINS_1}
      - ${APP_SECURITY_CORS_ALLOWED_ORIGINS_2}
    websocket-allowed-origins:
      - ${APP_SECURITY_WEBSOCKET_ALLOWED_ORIGINS_0}
      - ${APP_SECURITY_WEBSOCKET_ALLOWED_ORIGINS_1}
      - ${APP_SECURITY_WEBSOCKET_ALLOWED_ORIGINS_2}
  jwt:
    secret-key: ${JWT_SECRET}
    expiration-time: ${JWT_EXPIRATION_TIME}
    issuer: ${JWT_ISSUER}
  push:
    fcm:
      enabled: ${PUSH_FCM_ENABLED}
      dry-run: ${PUSH_FCM_DRY_RUN}
      credentials-path: ${PUSH_FCM_CREDENTIALS_PATH}
  telemetry:
    offline:
      threshold: ${TELEMETRY_OFFLINE_THRESHOLD}
      check-interval: ${TELEMETRY_OFFLINE_CHECK_INTERVAL}
    alerts:
      pressure-tampering-threshold: ${TELEMETRY_PRESSURE_TAMPERING_THRESHOLD}
      pressure-cut-threshold: ${TELEMETRY_PRESSURE_CUT_THRESHOLD}
      speed-suspect-threshold-mps: ${TELEMETRY_SPEED_SUSPECT_THRESHOLD_MPS}
      battery-low-threshold: ${TELEMETRY_BATTERY_LOW_THRESHOLD}
      battery-recovery-threshold: ${TELEMETRY_BATTERY_RECOVERY_THRESHOLD}
    mqtt:
      broker-url: ${TELEMETRY_MQTT_BROKER}
      client-id: ${TELEMETRY_MQTT_CLIENT}
      username: ${TELEMETRY_MQTT_USERNAME}
      password: ${TELEMETRY_MQTT_PASSWORD}
      topics:
        - ${TELEMETRY_MQTT_TOPIC}
      qos: ${TELEMETRY_MQTT_QOS}
      completion-timeout: ${TELEMETRY_MQTT_COMPLETION_TIMEOUT_MS}
      auto-startup: ${TELEMETRY_MQTT_AUTO_STARTUP}
    persistence:
      flush-interval: ${TELEMETRY_PERSISTENCE_FLUSH_INTERVAL}
      max-entries: ${TELEMETRY_PERSISTENCE_MAX_ENTRIES}

---
# Configuration pour le profil de développement
# Ce profil est activé automatiquement si SPRING_PROFILES_ACTIVE=dev
spring:
  config:
    activate:
      on-profile: dev
  jpa:
    hibernate:
      # En développement, Hibernate met à jour automatiquement le schéma
      # Les modifications des entités JPA sont appliquées automatiquement
      ddl-auto: update
    # Afficher les requêtes SQL générées dans les logs (utile pour le debug)
    show-sql: false
    properties:
      # Formater les requêtes SQL pour une meilleure lisibilité
      hibernate.format_sql: false

---
# Configuration pour le profil de production
# Ce profil est activé si SPRING_PROFILES_ACTIVE=prod
spring:
  config:
    activate:
      on-profile: prod
  jpa:
    hibernate:
      # En production, Hibernate valide seulement la cohérence du schéma
      # Ne modifie JAMAIS le schéma automatiquement (sécurité)
      # L'application échouera au démarrage si le schéma ne correspond pas aux entités
      ddl-auto: validate
    # Ne pas afficher les requêtes SQL en production (sécurité)
    show-sql: false
    properties:
      hibernate.format_sql: false
